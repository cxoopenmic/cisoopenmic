<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CISO Open Mic — Toronto Winter 2026 — Schedule</title>

<style>
:root{
  --bg:#05060a;
  --panel:#0b1020;
  --border:rgba(148,163,184,.22);
  --text:#f8fafc;
  --muted:#a7b0c0;
  --accent:#53336F;
  --ok:#22c55e;
  --warn:#fbbf24;
  --bad:#f87171;
}
*{box-sizing:border-box}
body{
  margin:0;
  background: radial-gradient(circle at top, #0d1633, var(--bg));
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  overflow:hidden;
}
.wrap{
  height:100vh;
  display:flex;
  flex-direction:column;
  padding:22px 26px;
  gap:18px;
}
.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:16px;
}
.title{
  font-size:22px;
  font-weight:800;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.status{
  font-size:12px;
  opacity:.9;
  display:flex;
  align-items:center;
  gap:10px;
  white-space:nowrap;
}
.dot{
  width:10px;height:10px;border-radius:999px;background:var(--warn);
  box-shadow:0 0 0 3px rgba(251,191,36,.18);
}
.dot.ok{ background:var(--ok); box-shadow:0 0 0 3px rgba(34,197,94,.18); }
.dot.bad{ background:var(--bad); box-shadow:0 0 0 3px rgba(248,113,113,.18); }

.grid{
  flex:1;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
  min-height:0;
}
.card{
  background:rgba(11,16,32,.92);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  overflow:hidden;
  min-height:0;
}
.block-title{
  font-weight:900;
  margin-bottom:10px;
  text-transform:uppercase;
  letter-spacing:.05em;
  opacity:.9;
}
.slot{
  display:flex;
  gap:12px;
  padding:8px 0;
  border-bottom:1px solid rgba(148,163,184,.15);
}
.slot:last-child{border-bottom:none}
.rank{
  font-weight:900;
  background:rgba(83,51,111,.25);
  border:1px solid rgba(83,51,111,.45);
  padding:4px 10px;
  border-radius:999px;
  min-width:54px;
  text-align:center;
}
.name{
  font-weight:800;
}
.talk{
  font-size:14px;
  opacity:.85;
}
.loading{
  opacity:.7;
}
.errorbox{
  margin-top:10px;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(248,113,113,.35);
  background:rgba(248,113,113,.08);
  color:#fecaca;
  font-size:12px;
  line-height:1.35;
  white-space:pre-wrap;
  max-height:140px;
  overflow:auto;
}
.timeline{
  display:grid;
  grid-template-columns:120px 1fr;
  gap:6px 10px;
  font-size:15px;
}
.footer{
  font-size:12px;
  opacity:.6;
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.kbd{
  border:1px solid rgba(148,163,184,.25);
  background: rgba(15,23,42,.7);
  padding:2px 8px;
  border-radius:8px;
  color:#cbd5f5;
}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="title">Toronto Winter 2026 — Live Schedule</div>

    <div class="status">
      <span id="dot" class="dot"></span>
      <span id="statusText">Loading…</span>
      <span>·</span>
      <span id="lastOk">—</span>
      <span>·</span>
      <span>Refresh <span class="kbd">15s</span></span>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="block-title">Performance Block 1</div>
      <div id="block1" class="loading">Loading lineup…</div>
    </div>

    <div class="card">
      <div class="block-title">Performance Block 2</div>
      <div id="block2" class="loading">Loading lineup…</div>
    </div>

    <div class="card">
      <div class="block-title">Tonight</div>
      <div class="timeline">
        <div>5:00</div><div>Reception & Networking</div>
        <div>6:00</div><div>Performance Block 1</div>
        <div>6:45</div><div>Intermission</div>
        <div>7:00</div><div>Performance Block 2</div>
        <div>7:45</div><div>Judge Deliberation</div>
        <div>7:55</div><div>Awards</div>
      </div>

      <div id="err" class="errorbox" style="display:none;"></div>
    </div>

    <div class="card">
      <div class="block-title">Sponsors</div>
      <div id="sponsors" class="loading">Loading sponsors…</div>
    </div>
  </div>

  <div class="footer">
    <div>Monitor view · Full screen recommended</div>
    <div>Event ID: <span class="kbd" id="eventIdPill"></span></div>
  </div>
</div>

<script>
(function(){
  const EVENT_ID = "event_toronto_2026_02_25";
  const BASE_API = "https://cxoopenmic.com/api/crm/public/event-schedule";
  const REFRESH_MS = 15000;

  const el = (id) => document.getElementById(id);

  el("eventIdPill").textContent = EVENT_ID;

  function esc(s){
    return String(s||"")
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;");
  }

  function renderSlot(p){
    const order = (p && p.performance_order != null) ? String(p.performance_order) : "?";
    const name  = (p && p.full_name) ? String(p.full_name) : "Speaker TBD";
    const talk  = (p && p.talk_title) ? String(p.talk_title) : "";
    return (
      '<div class="slot">' +
        '<div class="rank">#' + esc(order) + '</div>' +
        '<div>' +
          '<div class="name">' + esc(name) + '</div>' +
          '<div class="talk">' + esc(talk) + '</div>' +
        '</div>' +
      '</div>'
    );
  }

  function setStatus(state, msg){
    const dot = el("dot");
    dot.classList.remove("ok","bad");
    if (state === "ok") dot.classList.add("ok");
    else if (state === "bad") dot.classList.add("bad");
    el("statusText").textContent = msg || "";
  }

  function showErr(text){
    const box = el("err");
    if (!text) { box.style.display = "none"; box.textContent = ""; return; }
    box.style.display = "block";
    box.textContent = text;
  }

  function stampOk(){
    try{
      const d = new Date();
      el("lastOk").textContent = d.toISOString().replace("T"," ").slice(0,19) + "Z";
    }catch(_){
      el("lastOk").textContent = "Updated";
    }
  }

  async function load(){
    setStatus("warn","Loading…");
    showErr("");

    const url =
      BASE_API +
      "?event_id=" + encodeURIComponent(EVENT_ID) +
      "&_=" + Date.now(); // cache-buster

    let res, text, data;

    try{
      res = await fetch(url, {
        method: "GET",
        mode: "cors",
        credentials: "omit",
        cache: "no-store"
      });
    }catch(e){
      setStatus("bad","Error loading schedule");
      showErr("Fetch failed (network/CORS).\n" + String(e && (e.message || e) ? (e.message || e) : e));
      return;
    }

    try{
      text = await res.text();
    }catch(e){
      setStatus("bad","Error loading schedule");
      showErr("Failed reading response body.\nHTTP " + res.status);
      return;
    }

    // If Access is still in the way, you'll usually get HTML (login page) or a redirect result.
    const ct = String(res.headers.get("content-type") || "").toLowerCase();
    const looksJson = ct.includes("application/json") || (text && text.trim().startsWith("{"));

    if (!res.ok || !looksJson){
      setStatus("bad","Error loading schedule");

      const head = text ? text.trim().slice(0, 240) : "";
      const hint =
        (!looksJson && (ct.includes("text/html") || head.startsWith("<")))
          ? "\n\nHint: You are likely still being redirected to Cloudflare Access (HTML login), or CORS is blocked."
          : "";

      showErr(
        "HTTP " + res.status +
        "\nContent-Type: " + (ct || "—") +
        "\n\nBody (first 240 chars):\n" + head +
        hint
      );
      return;
    }

    try{
      data = JSON.parse(text);
    }catch(e){
      setStatus("bad","Error loading schedule");
      showErr("JSON parse failed.\nHTTP " + res.status + "\n\nBody (first 240 chars):\n" + text.trim().slice(0,240));
      return;
    }

    if (!data || !data.ok){
      setStatus("bad","Error loading schedule");
      showErr("API returned ok=false.\n\n" + JSON.stringify(data, null, 2).slice(0, 800));
      return;
    }

    const perfs = Array.isArray(data.performances) ? data.performances : [];
    const b1 = perfs.filter(p => Number(p.performance_block) === 1);
    const b2 = perfs.filter(p => Number(p.performance_block) === 2);

    el("block1").innerHTML = b1.length ? b1.map(renderSlot).join("") : '<div class="loading">No speakers yet.</div>';
    el("block2").innerHTML = b2.length ? b2.map(renderSlot).join("") : '<div class="loading">No speakers yet.</div>';

    // Sponsors: keep placeholder until you wire sponsor orgs into this endpoint
    el("sponsors").textContent = "—";

    stampOk();
    setStatus("ok","Live");
  }

  load();
  setInterval(load, REFRESH_MS);
})();
</script>
</body>
</html>
