<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CISO Open Mic — Toronto Winter 2026 — Schedule</title>

  <style>
    :root{
      --bg:#05060a;
      --panel:#0b1020;
      --border:rgba(148,163,184,.22);
      --text:#f8fafc;
      --muted:#a7b0c0;
      --accent:#53336F;
      --ok:#22c55e;
      --warn:#fbbf24;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      background: radial-gradient(circle at top, #0d1633, var(--bg));
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      overflow:hidden;
    }

    .wrap{
      height:100vh;
      display:flex;
      flex-direction:column;
      padding: 22px 26px;
      gap: 18px;
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 0;
    }

    .brand img{
      width:44px;
      height:44px;
      object-fit:contain;
      display:block;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.45));
    }

    .brand-title{
      display:flex;
      flex-direction:column;
      line-height:1.15;
      min-width:0;
    }

    .brand-title .kicker{
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      opacity:.82;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .brand-title .headline{
      font-size:22px;
      font-weight:800;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .statusbar{
      display:flex;
      align-items:center;
      gap:10px;
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .dot{
      width:9px;height:9px;border-radius:999px;background:var(--warn);
      box-shadow:0 0 0 3px rgba(251,191,36,.18);
    }
    .dot.ok{
      background:var(--ok);
      box-shadow:0 0 0 3px rgba(34,197,94,.18);
    }

    .grid{
      flex:1;
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 18px;
      min-height:0;
    }

    .card{
      background: rgba(11,16,32,.92);
      border:1px solid var(--border);
      border-radius: 16px;
      padding: 16px 18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      min-height:0;
      overflow:hidden;
    }

    .card h2{
      margin:0 0 10px;
      font-size:14px;
      letter-spacing:.10em;
      text-transform:uppercase;
      color: var(--muted);
    }

    .timeline{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap:8px 14px;
      font-size:16px;
      align-items:center;
    }
    .timeline .t{
      color:#dbe3f3;
      font-weight:800;
      letter-spacing:.02em;
    }
    .timeline .d{
      color:var(--text);
      font-weight:650;
    }
    .timeline .sub{
      grid-column: 2 / -1;
      margin-top:-6px;
      color: var(--muted);
      font-size:13px;
      line-height:1.3;
    }

    .blocks{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      height:100%;
      min-height:0;
    }

    .block{
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px 12px;
      background: rgba(2,6,23,.65);
      min-height:0;
      overflow:hidden;
    }

    .block .block-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .block .block-title .name{
      font-weight:900;
      letter-spacing:.06em;
      text-transform:uppercase;
      font-size:14px;
    }
    .pill{
      font-size:12px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      color: var(--muted);
      background: rgba(83,51,111,.12);
      white-space:nowrap;
    }

    .lineup{
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:auto;
      padding-right:6px;
      max-height: calc(100% - 34px);
    }

    .slot{
      display:flex;
      gap:12px;
      align-items:flex-start;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,.18);
      background: rgba(15,23,42,.50);
    }

    .portrait{
      width:54px;
      height:54px;
      min-width:54px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.25);
      background: rgba(148,163,184,.10);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      letter-spacing:.06em;
      color:#e5e7eb;
      overflow:hidden;
    }

    .slot .meta{
      min-width:0;
      flex:1;
    }

    .slot .who{
      font-weight:900;
      font-size:16px;
      line-height:1.2;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .slot .talk{
      margin-top:2px;
      font-size:14px;
      color:#dbe3f3;
      line-height:1.25;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    .slot .aux{
      margin-top:6px;
      font-size:12px;
      color: var(--muted);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .rank{
      font-weight:900;
      color:#fff;
      background: rgba(83,51,111,.25);
      border:1px solid rgba(83,51,111,.45);
      padding:2px 8px;
      border-radius:999px;
    }

    .sponsors{
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }

    .carousel{
      border:1px solid var(--border);
      border-radius:14px;
      background: rgba(2,6,23,.65);
      padding:12px;
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }

    .carousel .label{
      position:absolute;
      left:12px;
      top:12px;
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: var(--muted);
    }

    .carousel .item{
      text-align:center;
      font-size:26px;
      font-weight:900;
      opacity:.95;
      padding: 18px 12px;
    }

    .footer{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      color: var(--muted);
      font-size:12px;
      opacity:.9;
    }

    .kbd{
      border:1px solid rgba(148,163,184,.25);
      border-bottom-color: rgba(148,163,184,.4);
      background: rgba(15,23,42,.7);
      padding: 2px 8px;
      border-radius: 8px;
      color:#cbd5f5;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <img src="https://cxoopenmic.com/CxO.png" alt="CxO Open Mic" />
        <div class="brand-title">
          <div class="kicker">CISO Open Mic</div>
          <div class="headline">Toronto Winter 2026 — Live Schedule</div>
        </div>
      </div>

      <div class="statusbar">
        <span id="statusDot" class="dot"></span>
        <span id="statusText">Loading…</span>
        <span>·</span>
        <span id="lastUpdated">—</span>
        <span>·</span>
        <span>Auto-refresh <span class="kbd">15s</span></span>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Lineup</h2>
        <div class="blocks">
          <div class="block">
            <div class="block-title">
              <div class="name">Performance Block 1</div>
              <div class="pill">Starts 6:00</div>
            </div>
            <div id="block1" class="lineup"></div>
          </div>

          <div class="block">
            <div class="block-title">
              <div class="name">Performance Block 2</div>
              <div class="pill">Starts 7:00</div>
            </div>
            <div id="block2" class="lineup"></div>
          </div>
        </div>
      </div>

      <div class="card sponsors">
        <h2>Tonight</h2>
        <div class="timeline">
          <div class="t">5:00</div><div class="d">Reception & Networking</div>
          <div class="sub">Doors open. Sponsors + VIPs welcome to arrive early.</div>

          <div class="t">6:00</div><div class="d">Performance Block 1</div>
          <div class="sub">Open Mic talks begin.</div>

          <div class="t">6:45</div><div class="d">Intermission</div>
          <div class="sub">Networking break.</div>

          <div class="t">7:00</div><div class="d">Performance Block 2</div>
          <div class="sub">Second set of talks.</div>

          <div class="t">7:45</div><div class="d">Judge deliberation</div>
          <div class="sub">10 minutes.</div>

          <div class="t">7:55</div><div class="d">Awards</div>
          <div class="sub">10 minutes. Photos immediately after.</div>
        </div>

        <div class="carousel" aria-label="Sponsors carousel">
          <div class="label">Sponsors</div>
          <div id="sponsorCarousel" class="item">Your sponsors here</div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div>Monitor view · Full screen recommended</div>
      <div>Event ID: <span class="kbd" id="eventIdPill">event_toronto_2026_02_25</span></div>
    </div>
  </div>

  <script>
    (function(){
      var EVENT_ID = "event_toronto_2026_02_25";
      var ENDPOINT = "/api/crm/public/event-schedule?event_id=" + encodeURIComponent(EVENT_ID);
      var REFRESH_MS = 15000;

      var block1 = document.getElementById("block1");
      var block2 = document.getElementById("block2");
      var statusDot = document.getElementById("statusDot");
      var statusText = document.getElementById("statusText");
      var lastUpdated = document.getElementById("lastUpdated");

      function esc(s){
        return String(s || "")
          .replace(/&/g,"&amp;")
          .replace(/</g,"&lt;")
          .replace(/>/g,"&gt;")
          .replace(/"/g,"&quot;");
      }

      function initialsFromName(name){
        var n = String(name || "").trim();
        if (!n) return "TBD";
        var parts = n.split(/\s+/).filter(Boolean);
        var a = parts[0] ? parts[0].charAt(0) : "";
        var b = parts.length > 1 ? parts[parts.length-1].charAt(0) : "";
        var out = (a + b).toUpperCase();
        return out || "TBD";
      }

      function slotHtml(p){
        var full = String(p.full_name || "").trim() || null;
        var who = full || ("Speaker " + String(p.contact_id || "").trim() || "TBD");
        if (!full) who = "Speaker TBD";

        var talk = String(p.talk_title || "").trim() || "Talk title TBD";
        var org = String(p.organization_name || "").trim();
        var title = String(p.speaker_title || "").trim();
        var aux = [title, org].filter(Boolean).join(" · ");

        var rank = String(p.performance_order || "").trim();

        return (
          '<div class="slot">' +
            '<div class="portrait">' + esc(initialsFromName(full)) + '</div>' +
            '<div class="meta">' +
              '<div class="who"><span class="rank">#' + esc(rank) + '</span> ' + esc(who) + '</div>' +
              '<div class="talk">' + esc(talk) + '</div>' +
              (aux ? ('<div class="aux">' + esc(aux) + '</div>') : '') +
            '</div>' +
          '</div>'
        );
      }

      function setStatus(ok, msg){
        if (ok) statusDot.classList.add("ok");
        else statusDot.classList.remove("ok");
        statusText.textContent = msg || (ok ? "Live" : "Error");
      }

      function setUpdatedNow(){
        try {
          var d = new Date();
          lastUpdated.textContent = d.toISOString().replace("T"," ").slice(0,19) + "Z";
        } catch (_) {
          lastUpdated.textContent = "Updated";
        }
      }

      async function load(){
        try {
          setStatus(false, "Loading…");
          var res = await fetch(ENDPOINT, { method: "GET" });
          var text = await res.text();
          var data = null;
          try { data = text ? JSON.parse(text) : null; } catch(e) {}

          if (!res.ok || !data || !data.ok) {
            setStatus(false, "Error loading schedule");
            return;
          }

          var perfs = Array.isArray(data.performances) ? data.performances : [];
          var b1 = perfs.filter(function(x){ return Number(x.performance_block) === 1; });
          var b2 = perfs.filter(function(x){ return Number(x.performance_block) === 2; });

          block1.innerHTML = b1.length ? b1.map(slotHtml).join("") : '<div style="opacity:.75;">No speakers in Block 1 yet.</div>';
          block2.innerHTML = b2.length ? b2.map(slotHtml).join("") : '<div style="opacity:.75;">No speakers in Block 2 yet.</div>';

          setUpdatedNow();
          setStatus(true, "Live");
        } catch (e) {
          setStatus(false, "Error loading schedule");
        }
      }

      // Simple sponsor carousel stub (replace with real sponsor data later)
      var sponsors = ["Axonius", "Palo Alto Networks", "CyberArk", "WatchGuard", "Stellar Cyber"];
      var idx = 0;
      var carousel = document.getElementById("sponsorCarousel");
      function tickSponsor(){
        if (!carousel) return;
        carousel.textContent = sponsors[idx % sponsors.length];
        idx++;
      }
      tickSponsor();
      setInterval(tickSponsor, 4500);

      load();
      setInterval(load, REFRESH_MS);
    })();
  </script>
</body>
</html>
