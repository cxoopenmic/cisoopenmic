<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CISO Open Mic — Toronto Winter 2026 — Schedule</title>

<style>
:root{
  /* CISO Open Mic (from the hero button look) */
  --brandRed:#b43a3a;        /* left side */
  --brandOrange:#f08a2b;     /* right side */
  --brandGrad: linear-gradient(90deg, var(--brandRed), var(--brandOrange));

  /* Light theme */
  --bg:#f4f6f9;
  --panel:#ffffff;
  --border:rgba(15,23,42,.12);

  --text:#0b1220;
  --muted:rgba(15,23,42,.62);

  --ok:#16a34a;
  --warn:#d97706;
  --bad:#dc2626;

  --shadow: 0 18px 55px rgba(2,6,23,.10);
}

*{box-sizing:border-box}

body{
  margin:0;

  background:
    linear-gradient(180deg,
      rgba(240,138,43,.05) 0%,
      rgba(240,138,43,0) 220px
    ),
    linear-gradient(180deg, #f8f9fb 0%, #eef1f6 100%);

  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  overflow:hidden;
}
  
.wrap{
  height:100vh;
  display:flex;
  flex-direction:column;
  padding:22px 26px;
  gap:18px;
}

/* Top bar */
.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:16px;
  min-width:0;
}

.brand{
  display:flex;
  align-items:center;
  gap:12px;
  min-width:0;
}

.brandLogo{
  width:52px;
  height:52px;
  border-radius:10px;

  /* KEY: no white tile */
  background: transparent;
  border: none;
  box-shadow: none;

  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  flex:0 0 auto;
}
  
.brandLogo img{
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;

  /* KEY: no glow/shadow */
  filter: none;
}

.brandTitle{
  display:flex;
  flex-direction:column;
  line-height:1.15;
  min-width:0;
}
.kicker{
  font-size:12px;
  letter-spacing:.18em;
  text-transform:uppercase;
  color:var(--muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.title{
  font-size:22px;
  font-weight:850;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* Status */
.status{
  font-size:12px;
  color:var(--muted);
  display:flex;
  align-items:center;
  gap:10px;
  white-space:nowrap;
}

.dot{
  width:10px;
  height:10px;
  border-radius:999px;
  box-shadow:0 0 0 4px rgba(22,163,74,.15);
}
  
.dot.ok{ background:var(--ok); box-shadow:0 0 0 3px rgba(22,163,74,.14); }
.dot.bad{ background:var(--bad); box-shadow:0 0 0 3px rgba(220,38,38,.14); }

.kbd{
  border:1px solid rgba(15,23,42,.16);
  background: rgba(255,255,255,.9);
  padding:2px 8px;
  border-radius:8px;
  color:rgba(15,23,42,.70);
}

/* Layout */
.grid{
  flex:1;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
  min-height:0;
}

.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  overflow:hidden;
  min-height:0;
  box-shadow: var(--shadow);
}

.block-title{
  font-weight:900;
  margin-bottom:10px;
  text-transform:uppercase;
  letter-spacing:.08em;
  font-size:12px;
  color:rgba(15,23,42,.72);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.pill{
  font-size:12px;
  padding:5px 12px;
  border-radius:999px;
  border:0;
  background: var(--brandGrad);
  color:#fff;
  font-weight:850;
  letter-spacing:.02em;
  box-shadow: 0 10px 22px rgba(2,6,23,.12);
}

.slot{
  display:flex;
  gap:12px;
  padding:10px 0;
  border-bottom:1px solid rgba(15,23,42,.10);
}
.slot:last-child{border-bottom:none}

.rank{
  display:flex;
  align-items:center;
  justify-content:center;

  font-weight:900;
  background: var(--accentWash);
  border:1px solid rgba(234,88,12,.30);
  color: rgba(194,65,12,.95);

  height:34px;
  min-width:54px;

  border-radius:999px;
  flex:0 0 auto;
}

.name{
  font-weight:900;
  font-size:16px;
}
.talk{
  font-size:14px;
  color: rgba(15,23,42,.70);
  margin-top:2px;
  line-height:1.25;
}

.loading{
  color:rgba(15,23,42,.62);
}

.errorbox{
  margin-top:10px;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(220,38,38,.22);
  background:rgba(220,38,38,.06);
  color:#7f1d1d;
  font-size:12px;
  line-height:1.35;
  white-space:pre-wrap;
  max-height:140px;
  overflow:auto;
}

/* Tonight */
.timeline{
  display:grid;
  grid-template-columns:120px 1fr;
  gap:8px 10px;
  font-size:15px;
  color: rgba(15,23,42,.85);
}
.timeline .t{
  font-weight:900;
  color: rgba(2,6,23,.92);
}
.timeline .d{
  font-weight:650;
}

/* Footer */
.footer{
  font-size:12px;
  color:rgba(15,23,42,.62);
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.eventPill{
  border:1px solid rgba(15,23,42,.16);
  background: rgba(255,255,255,.9);
  padding:2px 8px;
  border-radius:8px;
  color:rgba(15,23,42,.70);
}
  .sponsorStage{
  margin-top:6px;
  position:relative;
  height:140px;            /* tune for your monitor */
  border:1px solid var(--border);
  border-radius:16px;
  background: #ffffff;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}

.sponsorImg{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:contain;
  padding:18px;
  opacity:0;
  transform: scale(0.985);
  transition: opacity 600ms ease, transform 600ms ease;
}

.sponsorImg.show{
  opacity:1;
  transform: scale(1);
}
 .title{
  font-size:22px;
  font-weight:850;
  background: linear-gradient(90deg, #b91c1c 0%, #ea580c 45%, #f97316 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

@media (max-width: 1100px){
  body{ overflow:auto; }
  .wrap{ height:auto; min-height:100vh; }
  .grid{ grid-template-columns:1fr; }
  .status{ flex-wrap:wrap; justify-content:flex-end; }
}
</style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <div class="brand">
      <div class="brandLogo">
        <img src="https://cisoopenmic.com/assets/logo.png" alt="CISO Open Mic logo">
      </div>
      <div class="brandTitle">
        <div class="kicker">CISO Open Mic</div>
        <div class="title">Toronto Winter 2026 — Live Schedule</div>
      </div>
    </div>

    <div class="status">
      <span id="dot" class="dot"></span>
      <span id="statusText">Loading…</span>
      <span>·</span>
      <span id="lastOk">—</span>
      <span>·</span>
      <span>Refresh <span class="kbd">15s</span></span>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="block-title">
        <span>Performance Block 1</span>
        <span class="pill">Starts 6:00</span>
      </div>
      <div id="block1" class="loading">Loading lineup…</div>
    </div>

    <div class="card">
      <div class="block-title">
        <span>Performance Block 2</span>
        <span class="pill">Starts 7:00</span>
      </div>
      <div id="block2" class="loading">Loading lineup…</div>
    </div>

    <div class="card">
      <div class="block-title">Tonight</div>
      <div class="timeline">
        <div class="t">5:00</div><div class="d">Reception & Networking</div>
        <div class="t">6:00</div><div class="d">Performance Block 1</div>
        <div class="t">6:45</div><div class="d">Intermission</div>
        <div class="t">7:00</div><div class="d">Performance Block 2</div>
        <div class="t">7:45</div><div class="d">Judge deliberation</div>
        <div class="t">7:55</div><div class="d">Awards</div>
      </div>

      <div id="err" class="errorbox" style="display:none;"></div>
    </div>

   <div class="card">
  <div class="block-title">Sponsors</div>

  <div class="sponsorStage">
    <img id="sponsorImgA" class="sponsorImg show" alt="Sponsor logo" />
    <img id="sponsorImgB" class="sponsorImg" alt="Sponsor logo" />
  </div>

  <div id="sponsorTier" class="loading" style="margin-top:10px; font-size:12px; opacity:.75;"></div>
</div>
  </div>

  <div class="footer">
    <div>Monitor view · Full screen recommended</div>
    <div>Event ID: <span class="eventPill" id="eventIdPill"></span></div>
  </div>
</div>

<script>
(function(){
  const EVENT_ID = "event_toronto_2026_02_25";
  const BASE_API = "https://cxoopenmic.com/api/crm/public/event-schedule";
  const REFRESH_MS = 15000;

  const el = (id) => document.getElementById(id);

  el("eventIdPill").textContent = EVENT_ID;

  function esc(s){
    return String(s||"")
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;");
  }

  function renderSlot(p){
    const order = (p && p.performance_order != null) ? String(p.performance_order) : "?";
    const name  = (p && p.full_name) ? String(p.full_name) : "Speaker TBD";
    const talk  = (p && p.talk_title) ? String(p.talk_title) : "";
    return (
      '<div class="slot">' +
        '<div class="rank">#' + esc(order) + '</div>' +
        '<div>' +
          '<div class="name">' + esc(name) + '</div>' +
          '<div class="talk">' + esc(talk) + '</div>' +
        '</div>' +
      '</div>'
    );
  }

  function setStatus(state, msg){
    const dot = el("dot");
    dot.classList.remove("ok","bad");
    if (state === "ok") dot.classList.add("ok");
    else if (state === "bad") dot.classList.add("bad");
    el("statusText").textContent = msg || "";
  }

  function showErr(text){
    const box = el("err");
    if (!text) { box.style.display = "none"; box.textContent = ""; return; }
    box.style.display = "block";
    box.textContent = text;
  }

  function stampOk(){
    try{
      const d = new Date();
      el("lastOk").textContent = d.toISOString().replace("T"," ").slice(0,19) + "Z";
    }catch(_){
      el("lastOk").textContent = "Updated";
    }
  }

let sponsorStarted = false;
let sponsorPrevLen = 0;
let sponsorTimer = null;
let sponsorIdx = 0;
let sponsorList = [];
let flip = false;

function normalizeSponsors(list) {
  const out = [];
  const seen = new Set();

  for (const s of (Array.isArray(list) ? list : [])) {
    const key = String(s?.sponsor_org_key || "").trim();
    if (!key) continue;
    if (seen.has(key)) continue;
    seen.add(key);

    const logo_url = String(s?.logo_url || "").trim();
    if (!logo_url) continue;

    out.push({
      sponsor_org_key: key,
      sponsor_org_name: String(s?.sponsor_org_name || "").trim(),
      tier: String(s?.tier || "").trim(),
      logo_url
    });
  }

  return out;
}

function setSponsorTier(s) {
  const tierBox = document.getElementById("sponsorTier");
  if (!tierBox) return;
  tierBox.textContent = (s && s.tier) ? ("Tier: " + String(s.tier)) : "";
}

function renderSponsorLogo(i){
  const a = document.getElementById("sponsorImgA");
  const b = document.getElementById("sponsorImgB");
  if (!a || !b) return;

  if (!Array.isArray(sponsorList) || sponsorList.length === 0) {
    a.removeAttribute("src");
    b.removeAttribute("src");
    setSponsorTier(null);
    return;
  }

  const s = sponsorList[i] || null;
  if (!s) return;

  const nextUrl = s.logo_url;

  const showEl = flip ? b : a;
  const hideEl = flip ? a : b;

  // Preload before switching to avoid “blank” flashes
  const img = new Image();
  img.onload = function(){
    showEl.src = nextUrl;

    hideEl.classList.remove("show");
    showEl.classList.add("show");

    setSponsorTier(s);
    flip = !flip;
  };
  img.onerror = function(){
    // skip this sponsor if the logo 404s
    sponsorIdx = (sponsorIdx + 1) % sponsorList.length;
  };
  img.src = nextUrl;
}

function startSponsorCarousel(){
  if (sponsorTimer) { clearInterval(sponsorTimer); sponsorTimer = null; }
  sponsorIdx = 0;
  renderSponsorLogo(0);

  if (sponsorList.length > 1) {
    sponsorTimer = setInterval(function(){
      sponsorIdx = (sponsorIdx + 1) % sponsorList.length;
      renderSponsorLogo(sponsorIdx);
    }, 6000);
  }
}


  
  async function load(){
    setStatus("warn","Loading…");
    showErr("");

    const url =
      BASE_API +
      "?event_id=" + encodeURIComponent(EVENT_ID) +
      "&_=" + Date.now();

    let res, text, data;

    try{
      res = await fetch(url, { method:"GET", mode:"cors", credentials:"omit", cache:"no-store" });
    }catch(e){
      setStatus("bad","Error loading schedule");
      showErr("Fetch failed (network/CORS).\n" + String(e && (e.message || e) ? (e.message || e) : e));
      return;
    }

    try{ text = await res.text(); }
    catch(_){
      setStatus("bad","Error loading schedule");
      showErr("Failed reading response body.\nHTTP " + res.status);
      return;
    }

    const ct = String(res.headers.get("content-type") || "").toLowerCase();
    const looksJson = ct.includes("application/json") || (text && text.trim().startsWith("{"));

    if (!res.ok || !looksJson){
      setStatus("bad","Error loading schedule");
      const head = text ? text.trim().slice(0, 240) : "";
      const hint =
        (!looksJson && (ct.includes("text/html") || head.startsWith("<")))
          ? "\n\nHint: This looks like HTML (often Cloudflare Access)."
          : "";
      showErr("HTTP " + res.status + "\nContent-Type: " + (ct || "—") + "\n\nBody (first 240 chars):\n" + head + hint);
      return;
    }

    try{ data = JSON.parse(text); }
    catch(_){
      setStatus("bad","Error loading schedule");
      showErr("JSON parse failed.\nHTTP " + res.status + "\n\nBody (first 240 chars):\n" + text.trim().slice(0,240));
      return;
    }

    if (!data || !data.ok){
      setStatus("bad","Error loading schedule");
      showErr("API returned ok=false.\n\n" + JSON.stringify(data, null, 2).slice(0, 800));
      return;
    }

const perfs = Array.isArray(data.performances) ? data.performances : [];
const b1 = perfs.filter(p => Number(p.performance_block) === 1);
const b2 = perfs.filter(p => Number(p.performance_block) === 2);

el("block1").innerHTML = b1.length ? b1.map(renderSlot).join("") : '<div class="loading">No speakers yet.</div>';
el("block2").innerHTML = b2.length ? b2.map(renderSlot).join("") : '<div class="loading">No speakers yet.</div>';

// ---- sponsors (logos) ----
sponsorList = normalizeSponsors(data.sponsors);

// Start carousel once; don’t restart on every refresh unless the list changed
if (!sponsorStarted) {
  startSponsorCarousel();
  sponsorStarted = true;
} else {
  // If the list changed, restart cleanly
  if (sponsorList.length !== sponsorPrevLen) {
    sponsorPrevLen = sponsorList.length;
    startSponsorCarousel();
  }
}

// Start carousel once; do NOT reset every refresh
if (!sponsorStarted) {
  startSponsorCarousel();
  sponsorStarted = true;
} else {
  // If sponsor list changed size, keep index valid
  if (sponsorIdx >= sponsorList.length) sponsorIdx = 0;
}

console.log("sponsors:", sponsorList.length, sponsorList);

stampOk();
setStatus("ok","Live");
  }

  load();
  setInterval(load, REFRESH_MS);
})();
</script>
</body>
</html>
